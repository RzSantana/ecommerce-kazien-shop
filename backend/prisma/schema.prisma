generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum DropStatus {
  ACTIVE
  COMING_SOON
  ENDED
}

model Product {
  id           String   @id @default(cuid())
  name         String
  price        Decimal  @db.Decimal(10, 2)
  cover        String   @db.Text
  currencyType String   @default("€") @db.VarChar(5)
  category     String   @db.VarChar(100)
  description  String?  @db.Text
  stock        Int      @default(0)
  isNew        Boolean  @default(false)
  isTopSale    Boolean  @default(false)
  isLimited    Boolean  @default(false)

  // Timestamps
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relaciones
  dropProducts DropProduct[]

  // Índices
  @@index([category])
  @@index([isNew])
  @@index([isTopSale])
  @@index([stock])
  @@fulltext([name, description])
  @@map("products")
}

model Drop {
  id          String      @id @default(cuid())
  name        String      @unique @db.VarChar(255)
  description String      @db.Text
  status      DropStatus  @default(ACTIVE)
  releaseDate DateTime
  endDate     DateTime?
  bannerImage String      @db.Text

  // Colores del tema
  primaryColor   String @db.VarChar(7)
  secondaryColor String @db.VarChar(7)
  accentColor    String @db.VarChar(7)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relaciones
  products    DropProduct[]

  @@index([status])
  @@index([releaseDate])
  @@map("drops")
}

model DropProduct {
  id        String  @id @default(cuid())
  dropId    String
  productId String

  // Campos específicos del producto en el drop
  dropPrice Decimal? @db.Decimal(10, 2)
  isLimited Boolean @default(false)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relaciones
  drop      Drop    @relation(fields: [dropId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([dropId, productId])
  @@index([dropId])
  @@index([productId])
  @@map("drop_products")
}
